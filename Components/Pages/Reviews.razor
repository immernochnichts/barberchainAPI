@inject BarberchainDbContext Context
@using MudBlazor

@if (ReviewList?.Count > 0)
{
    <MudPaper Elevation="3" Class="p-6 rounded-lg">
        <MudStack Spacing="3">
            <MudText Typo="Typo.h4">Мои отзывы</MudText>
            <MudDivider Class="mb-2" />

            @foreach (var r in ReviewList)
            {
                <MudCard Elevation="2" Class="mb-3">
                    <MudCardContent>
                        <MudStack Spacing="1">

                            <!-- Score + Barber -->
                            <MudStack Direction="Row" AlignItems="AlignItems.Start" Spacing="2">
                                <MudRating SelectedValue="@((int)r.Score)" MaxValue="5" ReadOnly="true" Size="Size.Medium"/>
                                <a href=@($"account/{r.Barber?.AccountId}")><MudText Style="color: cadetblue" Typo="Typo.subtitle1">@r.Barber?.Account?.Lastname@r.Barber?.Account?.Restname</MudText></a>
                            </MudStack>

                            <!-- Review text -->
                            <MudText Typo="Typo.body2">@r.Text</MudText>

                            <!-- Optional date -->
                            @if (r.CreatedAt != null)
                            {
                                <MudText Typo="Typo.caption" Color="Color.Secondary">
                                    @r.CreatedAt.ToString("dd MMMM yyyy")
                                </MudText>
                            }

                        </MudStack>
                    </MudCardContent>
                </MudCard>
            }
        </MudStack>
    </MudPaper>
}
else
{
    <MudPaper Elevation="3" Class="p-4 rounded-lg" Style="text-align:center;">
        <MudIcon Icon="@Icons.Material.Filled.Reviews" Color="Color.Secondary" Size="Size.Large" />
        <MudText Typo="Typo.h6" Class="mt-2">Нет отзывов</MudText>
        <MudText Typo="Typo.body2">Вы ещё не оставили отзывов о сотрудниках</MudText>
    </MudPaper>
}

@code {
    [Parameter]
    public int id { get; set; }

    private List<Review> ReviewList { get; set; }

    protected override async Task OnInitializedAsync()
    {
        ReviewList = await Context.Reviews
            .Where(r => r.AccountId == id)
            .Include(r => r.Barber)
                .ThenInclude(b => b.Account)
            .OrderByDescending(r => r.CreatedAt)
            .ToListAsync();
    }
}
