@namespace barberchainAPI.Components.Pages
@using MudBlazor
@inject NavigationManager Navigation
@inject BarberchainDbContext Context

<MudContainer MaxWidth="MaxWidth.Medium" Class="mt-6 text-center">

    <MudPaper Elevation="4" Class="pa-6">

        <!-- Success Icon -->
        <MudIcon Icon="@Icons.Material.Filled.CheckCircle" Color="Color.Success" Size="Size.Large" Class="mb-4" />

        @if (order != null)
        {
            <MudText Typo="Typo.h4" Class="mb-2">@(order.IsPaid ? "Заказ оформлен и оплачен" : "Заказ оформлен")</MudText>
            <MudText Typo="Typo.subtitle1" Class="mb-4">Ваш заказ <b>#@order.Id</b> был успешно обработан.</MudText>

            <MudStack Spacing="1" AlignItems="AlignItems.Start" Class="mb-4">
                <MudText>
                    Стоимость заказа: <b>@(
                        order.Barber.BarberJobs
                        .Where(bj => order.OrderJobs.Select(oj => oj.JobId).Contains(bj.JobId)) // only jobs in this order
                        .Sum(bj => bj.Price ?? bj.Job.DefaultPrice))
                    </b>
                </MudText>
                <MudText>Способ оплаты: <b>@(order.IsPaid ? "Банковская карта" : "На месте")</b></MudText>
                <MudText>Назначенное время: <b>@order.AppointedTime</b></MudText>
            </MudStack>

            <!-- Buttons -->
            <MudStack Direction="Row" Spacing="2" Justify="Justify.Center">
                @if (Account != null)
                {
                    <MudButton Variant="Variant.Filled" Color="Color.Primary" OnClick="GoToOrders">
                        Мои заказы
                    </MudButton>
                }
                <MudButton Variant="Variant.Outlined" Color="Color.Secondary" OnClick="GoHome">
                    На главную
                </MudButton>
            </MudStack>
        }

    </MudPaper>

</MudContainer>

@code {
    [Parameter]
    public Account Account { get; set; }

    [Parameter]
    public Order? order { get; set; }

    private void GoToOrders()
    {
        Navigation.NavigateTo($"/account/{Account.Id}?component=OrderHistory");
        Navigation.Refresh();
    }

    private void GoHome()
    {
        Navigation.NavigateTo("/");
        Navigation.Refresh();
    }
}