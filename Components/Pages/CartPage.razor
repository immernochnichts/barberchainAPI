@namespace barberchainAPI.Components.Pages
@using barberchainAPI.Functional
@inject BarberchainDbContext Context
@inject CartService CartService

<MudPaper Class="p-4 pa-4">
    @if (cart != null && cart.JobSet.Count > 0)
    {
        <MudContainer>
            <MudText>Нажмите на услугу, чтобы убрать её из корзины</MudText>
            <MudList T="string">
                @foreach (var job in cart.JobSet)
                {
                    <MudContainer Class="d-flex" Style="align-items:center">
                        <MudListItem Text=@job.Name />
                        <MudButton @onclick="async () => { await OnServiceClicked(job); }" Disabled="false" Style=@($"background:{(cart.JobSet.Contains(job) ? "gray" : job.ColorCSS)}; height:min-content;")>@(cart.JobSet.Contains(job) ? "Добавлено" : "")</MudButton>
                    </MudContainer>
                }
            </MudList>
        </MudContainer>
    }
    else
    {
        <MudStack Class="p-4 pa-4" Style="align-items: center;">
            <MudIcon Icon="@Icons.Material.Filled.ShoppingCart" Color="Color.Secondary" Size="Size.Large" />
            <MudText Typo="Typo.h6" Class="mt-2">Корзина пуста</MudText>
        </MudStack>
    }
</MudPaper>

@code {
    private Cart? cart;

    protected override async Task OnAfterRenderAsync(bool firstTime)
    {
        if (firstTime)
        {
            cart = await CartService.GetCart();
            StateHasChanged();
        }
    }

    private async Task OnServiceClicked(Job j)
    {
        if (cart!.JobSet.Contains(j))
        {
            await CartService.RemoveItem(j.Id);
        }
        else
        {
            await CartService.AddToCart(j);
        }

        cart = await CartService.GetCart(); // update the cart

        StateHasChanged();
    }
}